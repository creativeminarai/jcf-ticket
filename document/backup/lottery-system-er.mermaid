```mermaid
erDiagram
    SHOPS ||--o{ LOTTERY_TICKETS : "provides"
    SHOPS ||--o{ BATCH_ALLOCATIONS : "allocated_in"
    SHOPS ||--o{ WEIGHT_CHANGE_HISTORY : "has"
    
    LOTTERY_BATCHES ||--o{ LOTTERY_TICKETS : "contains"
    LOTTERY_BATCHES ||--o{ BATCH_ALLOCATIONS : "has"
    LOTTERY_BATCHES ||--o{ BATCH_GENERATION_QUEUE : "generated_from"
    
    LOTTERY_TICKETS ||--o{ USER_DRAWINGS : "drawn_as"
    
    USERS ||--o{ USER_DRAWINGS : "draws"
    USERS ||--o{ WEIGHT_CHANGE_HISTORY : "changes"
    USERS ||--o{ SYSTEM_SETTINGS : "updates"
    
    SYSTEM_SETTINGS {
        int setting_id PK
        int batch_size_multiplier
        int min_batch_size
        int max_batch_size
        int remaining_threshold
        timestamp updated_at
        varchar updated_by_user_id FK
    }
    
    SHOPS {
        varchar shop_id PK
        varchar shop_name
        int weight
        boolean active
        timestamp created_at
        timestamp updated_at
    }
    
    LOTTERY_BATCHES {
        int batch_id PK
        int batch_size
        enum status
        timestamp created_at
        timestamp activated_at
        timestamp completed_at
    }
    
    BATCH_ALLOCATIONS {
        int batch_id PK,FK
        varchar shop_id PK,FK
        int allocated_count
        decimal ideal_count
    }
    
    LOTTERY_TICKETS {
        int ticket_id PK
        int batch_id FK
        varchar shop_id FK
        int ticket_position
        enum status
        boolean is_drawn
        timestamp drawn_at
        varchar drawn_by_user_id FK
        timestamp disabled_at
        varchar disabled_reason
    }
    
    USERS {
        varchar user_id PK
        varchar username
        varchar email
        timestamp created_at
        timestamp last_login_at
    }
    
    USER_DRAWINGS {
        int drawing_id PK
        varchar user_id FK
        int ticket_id FK
        timestamp drawn_at
    }
    
    WEIGHT_CHANGE_HISTORY {
        int change_id PK
        varchar shop_id FK
        int old_weight
        int new_weight
        timestamp changed_at
        varchar changed_by_user_id FK
        text reason
    }
    
    BATCH_GENERATION_QUEUE {
        int queue_id PK
        timestamp requested_at
        enum priority
        enum status
        timestamp processed_at
        int batch_id FK
        text error_message
    }
```